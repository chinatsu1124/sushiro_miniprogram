<!--index.wxml-->
<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container">
    <!-- æ§åˆ¶é¢æ¿ -->
    <view class="controls">
      <view class="form-group">
        <text class="label">åœ°åŒº</text>
        <picker bindchange="onRegionChange" value="{{regionIndex}}" range="{{regions}}" disabled="{{loading}}">
          <view class="picker-text">{{regions[regionIndex] || 'è¯·é€‰æ‹©åœ°åŒº'}}</view>
        </picker>
      </view>

      <view class="form-group">
        <text class="label">é—¨åº—</text>
        <picker bindchange="onStoreChange" value="{{storeIndex}}" range="{{storeNames}}" disabled="{{loading || !selectedRegion}}">
          <view class="picker-text">{{selectedStore ? selectedStore.name : 'è¯·é€‰æ‹©é—¨åº—'}}</view>
        </picker>
      </view>

      <view class="form-group">
        <text class="label">æŸ¥è¯¢æ—¥æœŸ</text>
        <picker mode="date" bindchange="onDateChange" value="{{selectedDate}}" start="{{dateRangeStart}}" end="{{dateRangeEnd}}" disabled="{{loading || !selectedStore}}">
          <view class="picker-text">{{selectedDate || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
        </picker>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="btn-grid">
        <button class="btn primary" bindtap="loadData" disabled="{{loading || !selectedStore || !selectedDate}}">
          <text wx:if="{{loading}}">ğŸ”„ åŠ è½½ä¸­...</text>
          <text wx:else>ğŸ”„ æ›´æ–°æ•°æ®</text>
        </button>
        <button class="btn" bindtap="setToday">ğŸ“… ä»Šå¤©</button>
        <button class="btn" bindtap="setYesterday">ğŸ“… æ˜¨å¤©</button>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-div" wx:if="{{loading && !hasData}}">
      <text class="loading-title">ğŸ“Š æ­£åœ¨åŠ è½½æ•°æ®...</text>
      <text class="loading-subtitle">è¯·ç¨å€™ï¼Œæ­£åœ¨ä»æœåŠ¡å™¨è·å–æ•°æ®</text>
    </view>

    <!-- æ•°æ®ç»Ÿè®¡å¡ç‰‡ -->
    <view class="stats-grid" wx:if="{{hasData}}">
      <view class="stat-card primary">
        <text class="stat-value">{{stats.currentQueueCount || '-'}}</text>
        <text class="stat-label">å½“å‰é¡»ç­‰å¾…å·</text>
      </view>
      <view class="stat-card secondary">
        <text class="stat-value">{{stats.currentWaitTime || '-'}}</text>
        <text class="stat-label">é¢„è®¡ç­‰å¾…æ—¶é—´(åˆ†é’Ÿ)</text>
      </view>
      <view class="stat-card">
        <text class="stat-value">{{stats.avgCalls || '-'}}</text>
        <text class="stat-label">å¹³å‡æ¯åˆ†é’Ÿå«å·</text>
      </view>
      <view class="stat-card">
        <text class="stat-value">{{stats.maxCalls || '-'}}</text>
        <text class="stat-label">æœ€é«˜æ¯åˆ†é’Ÿå«å·</text>
      </view>
      <view class="stat-card">
        <text class="stat-value">{{stats.avgNewTickets || '-'}}</text>
        <text class="stat-label">å¹³å‡æ¯åˆ†é’Ÿæ–°å¢å·</text>
      </view>
      <view class="stat-card">
        <text class="stat-value">{{stats.maxNewTickets || '-'}}</text>
        <text class="stat-label">æœ€é«˜æ¯åˆ†é’Ÿæ–°å¢å·</text>
      </view>
    </view>

    <!-- ç½‘é¡µç‰ˆå›¾è¡¨é“¾æ¥ -->
    <view class="web-chart-link" wx:if="{{hasData}}">
      <view class="link-card">
        <view class="link-header">
          <text class="link-icon">ğŸ“Š</text>
          <text class="link-title">è¯¦ç»†å›¾è¡¨åˆ†æ</text>
        </view>
        <text class="link-subtitle">æŸ¥çœ‹å®Œæ•´çš„æ•°æ®è¶‹åŠ¿å›¾è¡¨å’Œæ·±åº¦åˆ†æ</text>
        <button class="link-btn" bindtap="openWebChart">
          ğŸŒ å‰å¾€ç½‘é¡µç‰ˆå›¾è¡¨
        </button>
        <text class="link-url">https://sushiro.chinatsu1124.com</text>
      </view>
    </view>

    <!-- æ¶ˆæ¯æç¤º -->
    <view class="message {{messageType}}" wx:if="{{message}}">
      <text>{{message}}</text>
    </view>

    <!-- åº•éƒ¨å ä½é€æ˜å¡ç‰‡ -->
    <view class="bottom-spacer">
      <text style="opacity: 0; font-size: 1rpx;">&nbsp;</text>
    </view>
  </view>
</scroll-view>
