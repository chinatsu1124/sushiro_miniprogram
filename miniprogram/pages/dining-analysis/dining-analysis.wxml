<!--dining-analysis.wxml-->
<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container">
    <!-- é—¨åº—é€‰æ‹©åŒºåŸŸ -->
    <view class="controls">
      <view class="form-group">
        <text class="label">åœ°åŒº</text>
        <picker bindchange="onRegionChange" value="{{regionIndex}}" range="{{regions}}" disabled="{{loading}}">
          <view class="picker-text">{{regions[regionIndex] || 'è¯·é€‰æ‹©åœ°åŒº'}}</view>
        </picker>
      </view>

      <view class="form-group">
        <text class="label">é—¨åº—</text>
        <picker bindchange="onStoreChange" value="{{storeIndex}}" range="{{storeNames}}" disabled="{{loading || !selectedRegion}}">
          <view class="picker-text">{{selectedStore ? selectedStore.name : 'è¯·é€‰æ‹©é—¨åº—'}}</view>
        </picker>
      </view>

      <view class="form-group">
        <text class="label">æœŸæœ›å°±é¤æ—¶é—´</text>
        <picker mode="time" value="{{diningTime}}" start="10:30" end="22:00" bindchange="onDiningTimeChange">
          <view class="picker-text">{{diningTime || 'è¯·é€‰æ‹©æ—¶é—´'}}</view>
        </picker>
        <text class="time-note">è¥ä¸šæ—¶é—´ï¼š10:30 - 22:00</text>
      </view>

      <button class="btn primary" bindtap="analyzeDiningTime" disabled="{{loading || !selectedStore || !diningTime}}">
        <text wx:if="{{loading}}">ğŸ“Š åˆ†æä¸­...</text>
        <text wx:else>ğŸ“Š å¼€å§‹åˆ†æ</text>
      </button>
    </view>

    <!-- åˆ†æç»“æœ -->
    <view class="analysis-result" wx:if="{{analysisResult}}">
      <view class="result-header">
        <text class="result-title">ğŸ“‹ åˆ†æç»“æœ</text>
        <text class="result-subtitle">åŸºäºå†å²æ•°æ®çš„æ™ºèƒ½åˆ†æ</text>
      </view>

      <!-- é¢„è®¡å–å·æ—¶é—´ä¿¡æ¯ -->
      <view class="result-card primary">
        <view class="result-icon">ğŸ«</view>
        <view class="result-content">
          <text class="result-value">{{analysisResult.estimatedIssueTime || '-'}}</text>
          <text class="result-label">é¢„è®¡å–å·æ—¶é—´</text>
          <text class="result-hint">å¦‚æœæ‚¨æŸ¥è¯¢çš„é—¨åº—å¼€æ”¾äº†çº¿ä¸Šå–å·ï¼Œè¯¥é¢„æµ‹å¯èƒ½ä¼šåæ™šï¼Œå»ºè®®æ‚¨æå‰å–å·</text>
        </view>
      </view>

      <!-- å†å²æ•°æ®ç»Ÿè®¡ -->
      <view class="history-stats">
        <text class="stats-title">ğŸ“Š å†å²æ•°æ®ç»Ÿè®¡</text>
        <view class="stats-grid">
          <view class="stat-item">
            <text class="stat-value">{{analysisResult.avgIssueTime || '-'}}</text>
            <text class="stat-label">å†å²å¹³å‡å–å·æ—¶é—´</text>
          </view>
          <view class="stat-item">
            <text class="stat-value">{{analysisResult.earliestIssueTime || '-'}}</text>
            <text class="stat-label">å†å²æœ€æ—©å–å·æ—¶é—´</text>
          </view>
          <view class="stat-item">
            <text class="stat-value">{{analysisResult.latestIssueTime || '-'}}</text>
            <text class="stat-label">å†å²æœ€æ™šå–å·æ—¶é—´</text>
          </view>
          <view class="stat-item">
            <text class="stat-value">{{analysisResult.dataPoints}}å¤©</text>
            <text class="stat-label">åˆ†æå¤©æ•°</text>
          </view>
        </view>
      </view>

      <!-- å†å²å–å·æ—¶é—´è¯¦æƒ… -->
      <view class="history-details" wx:if="{{historyData && historyData.length > 0}}">
        <text class="history-title">ğŸ“… å†å²å–å·æ—¶é—´è¯¦æƒ…</text>
        <view class="history-list">
          <view class="history-item" wx:for="{{historyData}}" wx:key="date">
            <view class="history-date">
              <text class="date-text">{{item.date}}</text>
              <text class="weekday-text {{item.isWeekend ? 'weekend' : 'weekday'}}" wx:if="{{item.weekday}}">{{item.weekday}}</text>
            </view>
            <view class="history-times">
              <text class="issue-time">å–å·: {{item.estimated_issue_time}}</text>
              <text class="wait-time">ç­‰å¾…: {{item.waitTime}}åˆ†é’Ÿ</text>
            </view>
            <view class="confidence-badge {{item.confidence}}">{{item.confidence === 'high' ? 'é«˜ä¿¡åº¦' : 'ä½ä¿¡åº¦'}}</view>
          </view>
        </view>
      </view>

      <!-- æœ€ä½³æ—¶é—´æ¨è -->
      <view class="best-times" wx:if="{{analysisResult.bestTimes && analysisResult.bestTimes.length > 0}}">
        <text class="best-times-title">â­ æ¨èå°±é¤æ—¶é—´</text>
        <view class="times-list">
          <view class="time-item" wx:for="{{analysisResult.bestTimes}}" wx:key="time">
            <text class="time-value">{{item.time}}</text>
            <text class="time-wait">çº¦ç­‰{{item.waitTime}}åˆ†é’Ÿ</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ— æ•°æ®æç¤º -->
    <view class="no-data" wx:if="{{!loading && !analysisResult && hasAnalyzed}}">
      <text class="no-data-title">ğŸ“‹ æš‚æ— åˆ†ææ•°æ®</text>
      <text class="no-data-subtitle">è¯·é€‰æ‹©é—¨åº—å’Œæ—¶é—´åè¿›è¡Œåˆ†æ</text>
    </view>

    <!-- æ¶ˆæ¯æç¤º -->
    <view class="message {{messageType}}" wx:if="{{message}}">
      <text>{{message}}</text>
    </view>

    <!-- åº•éƒ¨å ä½é€æ˜å¡ç‰‡ -->
    <view class="bottom-spacer">
      <text style="opacity: 0; font-size: 1rpx;">&nbsp;</text>
    </view>
  </view>
</scroll-view>
